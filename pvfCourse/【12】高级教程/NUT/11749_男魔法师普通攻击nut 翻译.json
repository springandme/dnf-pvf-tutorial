{
    "content": "<pre>\n<code>// state”刻在这里，您将第一次进入。配置各种资源\nfunction onSetState_Attack(obj, state, datas, isResetTimer)\n{   \n    if (!obj)\n        return;\n        //得到技能等级\n    local skillLevel = obj.sq_GetSkillLevel(SKILL_ICE_ELEMENTAL_ATTACK);\n \n    // 学会了转职\n    if (skillLevel &gt; 0)\n    {\n        // 常规攻击时前进处理\n             //攻击速度250\n        obj.setAttackXVelocity(250);\n             //加速度-1000\n        obj.setAttackXAccel(-1000);\n             //攻击速率 400\n        obj.setAttackXVelocityFast(400);\n             //渐块-1000\n        obj.setAttackXAccelFast(-1000);\n         \n        // 使用基本技能   \n        //申请攻击向上\n        obj.applyBasicAttackUp(sq_GetCurrentAttackInfo(obj),obj.getState());        \n        sq_SetCurrentAttackInfo(obj, sq_GetCurrentAttackInfo(obj));\n    }\n    else\n    {\n        // 如果你还没有学会转职\n        obj.setAttackXVelocity(0);\n        obj.setAttackXAccel(0);\n        obj.setAttackXVelocityFast(0);\n        obj.setAttackXAccelFast(0);\n        local element = obj.getThrowElement();\n        local attackIndex = obj.getAttackIndex();\n        playSoundForAtmageAttack(obj, element, attackIndex);\n    }\n}\n \n \nfunction onAfterSetState_Attack(obj, state, datas, isResetTimer)\n{\n    if (!obj) return;\n \n    // 一种修身艺术\n    // 不发射魔球.\n    local iceElementalAttackSkillLevel = obj.sq_GetSkillLevel(SKILL_ICE_ELEMENTAL_ATTACK);\n \n \n    if (state == STATE_ATTACK &amp;&amp; iceElementalAttackSkillLevel &lt;= 0)\n    {\n        // 将发挥平打效果\n        // 按悬停的按钮索引和发球台显示的效果不同(按属性粘贴的效果不同)\n        local element = obj.getThrowElement();\n        local attackIndex = obj.getAttackIndex();\n         \n        // 检查是否挂在属性启动appendage上。\n        // 如果没有被属性启动，则发射了无属性平打\n        local appendage = obj.GetSquirrelAppendage(\"Character/ATMage/ElementalChange/ap_ATMage_Elemental_Change.nut\");\n        if (!appendage || !appendage.isValid())\n            element = ENUM_ELEMENT_NONE;\n \n        if (attackIndex == 0)\n        {\n            if (element == ENUM_ELEMENT_FIRE)\n            {   // 火属性\n                       // 创建CNRD ani数据库 添加到ani状态层\n                obj.sq_AddStateLayerAnimation(1, obj.sq_CreateCNRDAnimation(\"Effect/Animation/ATAttack/fire/attack1_fire_normal.ani\"), 0, 0);\n                obj.sq_AddStateLayerAnimation(2, obj.sq_CreateCNRDAnimation(\"Effect/Animation/ATAttack/fire/attack1_fire_dodge.ani\"), 0, 0);\n            }\n            else if (element == ENUM_ELEMENT_WATER)\n            {   //水属性\n                obj.sq_AddStateLayerAnimation(1, obj.sq_CreateCNRDAnimation(\"Effect/Animation/ATAttack/water/attack1_water_normal.ani\"), 0, 0);\n                obj.sq_AddStateLayerAnimation(2, obj.sq_CreateCNRDAnimation(\"Effect/Animation/ATAttack/water/attack1_water_dodge.ani\"), 0, 0);\n            }\n            else if (element == ENUM_ELEMENT_DARK)\n            {   // 暗属性\n                obj.sq_AddStateLayerAnimation(1, obj.sq_CreateCNRDAnimation(\"Effect/Animation/ATAttack/dark/attack1_dark_normal.ani\"), 0, 0);\n                obj.sq_AddStateLayerAnimation(2, obj.sq_CreateCNRDAnimation(\"Effect/Animation/ATAttack/dark/attack1_dark_dodge.ani\"), 0, 0);\n            }\n            else if (element == ENUM_ELEMENT_LIGHT)\n            {   // 光属性\n                obj.光q_AddStateLayerAnimation(1, obj.sq_CreateCNRDAnimation(\"Effect/Animation/ATAttack/light/attack1_light_normal.ani\"), 0, 0);\n                obj.sq_AddStateLayerAnimation(2, obj.sq_CreateCNRDAnimation(\"Effect/Animation/ATAttack/light/attack1_light_dodge.ani\"), 0, 0);\n            }\n            else if (element == ENUM_ELEMENT_NONE)\n            {   // 无属性\n                obj.sq_AddStateLayerAnimation(1, obj.sq_CreateCNRDAnimation(\"Effect/Animation/ATAttack/attack1_none_normal.ani\"), 0, 0);\n                obj.sq_AddStateLayerAnimation(2, obj.sq_CreateCNRDAnimation(\"Effect/Animation/ATAttack/attack1_none_dodge.ani\"), 0, 0);\n            }\n        }\n        else if (attackIndex == 1)\n        {\n            if (element == ENUM_ELEMENT_FIRE)\n            {   // 火\n                obj.sq_AddStateLayerAnimation(1, obj.sq_CreateCNRDAnimation(\"Effect/Animation/ATAttack/fire/attack2_fire_normal.ani\"), 0, 0);\n                obj.sq_AddStateLayerAnimation(2, obj.sq_CreateCNRDAnimation(\"Effect/Animation/ATAttack/fire/attack2_fire_dodge.ani\"), 0, 0);\n            }\n            else if (element == ENUM_ELEMENT_WATER)\n            {   // 水\n                obj.sq_AddStateLayerAnimation(1, obj.sq_CreateCNRDAnimation(\"Effect/Animation/ATAttack/water/attack2_water_normal.ani\"), 0, 0);\n                obj.sq_AddStateLayerAnimation(2, obj.sq_CreateCNRDAnimation(\"Effect/Animation/ATAttack/water/attack2_water_dodge.ani\"), 0, 0);\n            }\n            else if (element == ENUM_ELEMENT_DARK)\n            {   // 暗\n                obj.sq_AddStateLayerAnimation(1, obj.sq_CreateCNRDAnimation(\"Effect/Animation/ATAttack/dark/attack2_dark_normal.ani\"), 0, 0);\n                obj.sq_AddStateLayerAnimation(2, obj.sq_CreateCNRDAnimation(\"Effect/Animation/ATAttack/dark/attack2_dark_dodge.ani\"), 0, 0);\n            }\n            else if (element == ENUM_ELEMENT_LIGHT)\n            {   // 光\n                obj.sq_AddStateLayerAnimation(1, obj.sq_CreateCNRDAnimation(\"Effect/Animation/ATAttack/light/attack2_light_normal.ani\"), 0, 0);\n                obj.sq_AddStateLayerAnimation(2, obj.sq_CreateCNRDAnimation(\"Effect/Animation/ATAttack/light/attack2_light_dodge.ani\"), 0, 0);\n            }\n            else if (element == ENUM_ELEMENT_NONE)\n            {   // ???\n                obj.sq_AddStateLayerAnimation(1, obj.sq_CreateCNRDAnimation(\"Effect/Animation/ATAttack/attack2_none_normal.ani\"), 0, 0);\n                obj.sq_AddStateLayerAnimation(2, obj.sq_CreateCNRDAnimation(\"Effect/Animation/ATAttack/attack2_none_dodge.ani\"), 0, 0);\n            }\n        }\n        else if (attackIndex == 2)\n        {\n            if (element == ENUM_ELEMENT_FIRE)\n            {   //火\n                obj.sq_AddStateLayerAnimation(1, obj.sq_CreateCNRDAnimation(\"Effect/Animation/ATAttack/fire/attack3_fire_normal.ani\"), 0, 0);\n                obj.sq_AddStateLayerAnimation(2, obj.sq_CreateCNRDAnimation(\"Effect/Animation/ATAttack/fire/attack3_fire_dodge.ani\"), 0, 0);\n            }\n            else if (element == ENUM_ELEMENT_WATER)\n            {   // 水\n                obj.sq_AddStateLayerAnimation(1, obj.sq_CreateCNRDAnimation(\"Effect/Animation/ATAttack/water/attack3_water_normal.ani\"), 0, 0);\n                obj.sq_AddStateLayerAnimation(2, obj.sq_CreateCNRDAnimation(\"Effect/Animation/ATAttack/water/attack3_water_dodge.ani\"), 0, 0);\n            }\n            else if (element == ENUM_ELEMENT_DARK)\n            {   // 暗\n                obj.sq_AddStateLayerAnimation(1, obj.sq_CreateCNRDAnimation(\"Effect/Animation/ATAttack/dark/attack3_dark_normal.ani\"), 0, 0);\n                obj.sq_AddStateLayerAnimation(2, obj.sq_CreateCNRDAnimation(\"Effect/Animation/ATAttack/dark/attack3_dark_dodge.ani\"), 0, 0);\n            }\n            else if (element == ENUM_ELEMENT_LIGHT)\n            {   // 暗\n                obj.sq_AddStateLayerAnimation(1, obj.sq_CreateCNRDAnimation(\"Effect/Animation/ATAttack/light/attack3_light_normal.ani\"), 0, 0);\n                obj.sq_AddStateLayerAnimation(2, obj.sq_CreateCNRDAnimation(\"Effect/Animation/ATAttack/light/attack3_light_dodge.ani\"), 0, 0);\n            }\n            else if (element == ENUM_ELEMENT_NONE)\n            {   // 光\n                obj.sq_AddStateLayerAnimation(1, obj.sq_CreateCNRDAnimation(\"Effect/Animation/ATAttack/attack3_none_normal.ani\"), 0, 0);\n                obj.sq_AddStateLayerAnimation(2, obj.sq_CreateCNRDAnimation(\"Effect/Animation/ATAttack/attack3_none_dodge.ani\"), 0, 0);\n            }\n        }\n        else if (attackIndex == 3)\n        {\n            if (element == ENUM_ELEMENT_FIRE)\n            {   // 火\n                obj.sq_AddStateLayerAnimation(1, obj.sq_CreateCNRDAnimation(\"Effect/Animation/ATAttack/fire/attack4_fire_normal.ani\"), 0, 0);\n                obj.sq_AddStateLayerAnimation(2, obj.sq_CreateCNRDAnimation(\"Effect/Animation/ATAttack/fire/attack4_fire_dodge.ani\"), 0, 0);\n            }\n            else if (element == ENUM_ELEMENT_WATER)\n            {   // 水\n                obj.sq_AddStateLayerAnimation(1, obj.sq_CreateCNRDAnimation(\"Effect/Animation/ATAttack/water/attack4_water_normal.ani\"), 0, 0);\n                obj.sq_AddStateLayerAnimation(2, obj.sq_CreateCNRDAnimation(\"Effect/Animation/ATAttack/water/attack4_water_dodge.ani\"), 0, 0);\n            }\n            else if (element == ENUM_ELEMENT_DARK)\n            {   // 暗\n                obj.sq_AddStateLayerAnimation(1, obj.sq_CreateCNRDAnimation(\"Effect/Animation/ATAttack/dark/attack4_dark_normal.ani\"), 0, 0);\n                obj.sq_AddStateLayerAnimation(2, obj.sq_CreateCNRDAnimation(\"Effect/Animation/ATAttack/dark/attack4_dark_dodge.ani\"), 0, 0);\n            }\n            else if (element == ENUM_ELEMENT_LIGHT)\n            {   // 光\n                obj.sq_AddStateLayerAnimation(1, obj.sq_CreateCNRDAnimation(\"Effect/Animation/ATAttack/light/attack4_light_normal.ani\"), 0, 0);\n                obj.sq_AddStateLayerAnimation(2, obj.sq_CreateCNRDAnimation(\"Effect/Animation/ATAttack/light/attack4_light_dodge.ani\"), 0, 0);\n            }\n            else if (element == ENUM_ELEMENT_NONE)\n            {\n                obj.sq_AddStateLayerAnimation(1, obj.sq_CreateCNRDAnimation(\"Effect/Animation/ATAttack/attack4_none_normal.ani\"), 0, 0);\n                obj.sq_AddStateLayerAnimation(2, obj.sq_CreateCNRDAnimation(\"Effect/Animation/ATAttack/attack4_none_dodge.ani\"), 0, 0);\n            }\n        }\n    }   \n}\n \nfunction createMiniMagicCircle(obj, xPos, zPos, shotDirection, bonusDamage) // direction 0:??  1:???  2:??)\n{   \n    if(!obj)\n        return;\n    if (obj.sq_IsMyControlObject()) {\n     \n        // 魔法具体生成的位置\n        local direction = sq_GetDirection(obj);\n        local x = sq_GetDistancePos(obj.getXPos(), direction, xPos);\n        local y = sq_GetDistancePos(obj.getYPos(), ENUM_DIRECTION_DOWN, 1);\n        local z = sq_GetDistancePos(obj.getZPos(), ENUM_DIRECTION_UP, zPos);\n        // 有一点诱导功能。\n        // 进攻者\n        // 发射位置(x,y,z)\n        // 垂直发射角(0向前发射，30右30度发射)\n        // 垂直发射角(0向前发射，-30向下发射30度)\n        // 横向最大校正角(单向)\n        // 垂直最大校正角(单向)\n        // 与敌人的最大距离。是-无限制\n        // x轴最大射程\n        // 攻击框的x轴大小\n        // 攻击框的y轴大小\n        // 攻击框的y轴大小\n         \n        local activeObject;\n        local searchAngleH = 0;\n        local searchAngleV = 0;\n        local passiveObjectIndex = 0;       \n         \n        if(shotDirection == 0)\n        {   // 正面\n                                   //查找射击目标\n            //activeObject = sq_FindShootingTarget(obj, x, y, z, 0, 0, 10, 10, -1, 1000, 1000, 250, 100);   \n            local distance = 1000;\n            local angle = 20;\n            activeObject = findAngleTarget(obj, distance, angle, 100); // 扇形样子攻击敌人  （好像是）       \n            searchAngleH = 30;\n            searchAngleV = 15;\n            passiveObjectIndex = 24202;\n         \n            // 连续发射的外形相同，但对象却不同(因为受变换的影响)\n            if (obj.getState() == STATE_MULTI_SHOT)\n                passiveObjectIndex = 24266;\n        }\n        else if(shotDirection == 1) {// 对角线\n            activeObject = sq_FindShootingTarget(obj, x, y, z, 0, 0, 4, 4, -1, 300, 100, 50, 100);\n            searchAngleH = 5;\n            searchAngleV = 5;           \n            passiveObjectIndex = 24207;\n             \n            // 连续发射的外形相同，但对象却不同(因为受变换的影响)\n            if (obj.getState() == STATE_MULTI_SHOT)\n                passiveObjectIndex = 24271;\n        }\n        else if(shotDirection == 2) { // ??\n            activeObject = sq_FindShootingTarget(obj, x, y, z, 0, 0, 4, 4, -1, 300, 100, 50, 100);          \n            searchAngleH = 5;\n            searchAngleV = 5;   \n            passiveObjectIndex = 24228;\n             \n            // 连续发射的外形相同，但对象却不同(因为受变换的影响)\n            if (obj.getState() == STATE_MULTI_SHOT)\n                passiveObjectIndex = 24276;\n        }               \n        else {\n            printc(\"error! magic ball create shotDirection error\");\n            return;\n        }\n         \n        // 检查是否挂在属性启动appendage上。\n        // 如果没有被属性启动，则发射了无属性平打\n        local horizonAngle = 0.0;\n        local verticalAngle = 0.0;  \n        if (activeObject != NULL) {     \n            local maxDistance = abs(activeObject.getXPos() - x);\n            //锐角射击视野\n            horizonAngle = sq_GetShootingHorizonAngle(activeObject, y, 0, searchAngleH, maxDistance);\n            //垂直角射击视野\n            verticalAngle = sq_GetShootingVerticalAngle(activeObject, z, 0, searchAngleV, maxDistance, 300);\n        }\n             \n        local appendage = obj.GetSquirrelAppendage(\"Character/ATMage/ElementalChange/ap_ATMage_Elemental_Change.nut\");\n        if (appendage &amp;&amp; appendage.isValid()) { \n            local element = obj.getThrowElement();\n            passiveObjectIndex = passiveObjectIndex + 1 + element;\n        }\n         \n        obj.sq_StartWrite();\n        obj.sq_WriteFloat(horizonAngle);\n        obj.sq_WriteFloat(verticalAngle);\n        obj.sq_WriteDword(bonusDamage);     \n        obj.sq_SendCreatePassiveObjectPacket(passiveObjectIndex, 0, xPos, 1, zPos);\n    }\n}\n \n// 攻击时生成魔法体。\nfunction onKeyFrameFlag_Attack(obj, flagIndex)\n{\n    if(!obj)\n        return false;\n    local isMyControlObject = obj.sq_IsMyControlObject();\n \n    // 每次攻击时会产生魔法球体。\n    // 要根据悬浮的黄蜂而生成的“被动对象”有所不同(属性)\n    // \n    local xPos = 0, zPos = 0;\n \n    local attackIndex = obj.getAttackIndex();\n    if (attackIndex == 0)\n    {\n        xPos = 65, zPos = 59;\n    }\n    else if (attackIndex == 1)\n    {\n        xPos = 60, zPos = 71;\n    }\n    else if (attackIndex == 2)\n    {\n        xPos = 55, zPos = 58;\n    }\n    else if (attackIndex == 3)\n    {\n        xPos = 65, zPos = 36;\n    }\n \n    if (flagIndex == 1)\n    {\n        // 产生魔法球。\n        createMiniMagicCircle(obj, xPos, zPos, 0, 0); // 方向 0:正面1:对角线2:下端\n    }\n \n \n    return true;\n}\n \nfunction playSoundForAtmageAttack(obj, elementalType, attackCount)\n{   \n    if(!obj)\n        return;\n \n    local elementalName = \"MWSHOT_0\";\n    if (elementalType == ENUM_ELEMENT_FIRE)\n        elementalName = \"FIRESHOT_0\";\n    else if (elementalType == ENUM_ELEMENT_WATER)\n        elementalName = \"ICESHOT_0\";\n    else if (elementalType == ENUM_ELEMENT_DARK)\n        elementalName = \"DARKSHOT_0\";\n    else if (elementalType == ENUM_ELEMENT_LIGHT)\n        elementalName = \"LIGHTSHOT_0\";\n     \n    obj.sq_PlaySound(elementalName + (attackCount+1));\n}</code></pre>\n\n<p>&nbsp;</p>",
    "auth_users": "学院搬运工",
    "img": "https://dafstatic.oss-cn-beijing.aliyuncs.com/static/title/level4.gif",
    "create_at": "2023-07-03T12:53:33.160",
    "view_num": 569
}