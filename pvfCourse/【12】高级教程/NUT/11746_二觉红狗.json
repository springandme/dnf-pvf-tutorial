{
    "content": "<pre>\n<code>//血魔·弒天\n \nfunction checkExecutableSkill_bloodrivern(obj)\n{\n    if (!obj) return false;\n \n    local isUseSkill = obj.sq_IsUseSkill(SKILL_BLOODRIVERN);\n    if (isUseSkill) \n    {\n        obj.getVar(\"size\").clear_vector();\n        obj.getVar(\"size\").push_vector(100);\n        //初始化大小\n        obj.getVar(\"state\").clear_vector();\n        obj.getVar(\"state\").push_vector(0);\n        obj.sq_IsEnterSkillLastKeyUnits(SKILL_BLOODRIVERN);\n        obj.sq_AddSetStatePacket(STATE_BLOODRIVERN, STATE_PRIORITY_USER, true);\n        return true;\n    }\n    return false;\n}\n \n \nfunction checkCommandEnable_bloodrivern(obj)\n{\n \n    return true;\n}\n \n \n \n \nfunction onSetState_BLOODRIVERN(obj, state, datas, isResetTimer)\n{\n    local state = obj.getVar(\"state\").get_vector(0);\n    local size = obj.getVar(\"size\").get_vector(0);\n \n    obj.sq_StopMove();\n    if (state == 0)\n    {\n        //鮮血包裹準備\n        obj.sq_SetCurrentAnimation(CUSTOM_ANI_BLOODRIVERN_CASTING);\n \n    }else if (state == 1)\n    {\n        //大球不斷旋轉\n        obj.sq_SetCurrentAnimation(CUSTOM_ANI_BLOODRIVERN_GROUND);\n        obj.sq_SetCurrentAttackInfo(ATTACKINFO_BLOODRIVERN_MUSHATTACK);\n        obj.resetHitObjectList();\n \n        local attT = obj.sq_GetIntData(SKILL_BLOODRIVERN, 0);\n        //150\n        local maxS = obj.sq_GetIntData(SKILL_BLOODRIVERN, 2);\n        //蓄力最大的大小 size 200\n        obj.getVar(\"mSize\").clear_vector();\n        obj.getVar(\"mSize\").push_vector(maxS);\n \n        obj.setTimeEvent(0,attT,0,false);       \n \n        local attackBonusRate = obj.sq_GetBonusRateWithPassive(SKILL_BLOODRIVERN, STATE_BLOODRIVERN, 0, 1.0);\n        obj.sq_SetCurrentAttackBonusRate(attackBonusRate);              \n \n    }else if (state == 2)\n    {\n        //變成一條大狗\n        obj.sq_SetCurrentAnimation(CUSTOM_ANI_BLOODRIVERN_READYOUT);\n        sq_SetMyShake(obj,3,200);\n \n        obj.sq_SetCurrentAttackInfo(ATTACKINFO_BLOODRIVERN_MUSHATTACK);\n \n        local attackBonusRate = obj.sq_GetBonusRateWithPassive(SKILL_BLOODRIVERN, STATE_BLOODRIVERN, 0, 1.0);\n        obj.sq_SetCurrentAttackBonusRate(attackBonusRate);              \n \n        local level = sq_GetSkillLevel(obj, SKILL_BLOODRIVERN);     \n        local xy_proc = sq_GetLevelData(obj, SKILL_BLOODRIVERN, 3, level);\n        local xy_level = sq_GetLevelData(obj, SKILL_BLOODRIVERN, 4, level);\n        local xy_time = sq_GetLevelData(obj,SKILL_BLOODRIVERN, 5, level);\n        //眩暈參數\n        local attackInfo = sq_GetCurrentAttackInfo(obj);\n        sq_SetChangeStatusIntoAttackInfo(attackInfo, 0, ACTIVESTATUS_STUN, xy_proc, xy_level, xy_time );\n        //震動\n    }else if (state == 3)\n    {\n        //跳躍\n        obj.sq_SetCurrentAnimation(CUSTOM_ANI_BLOODRIVERN_JUMP);\n        obj.sq_SetCurrentAttackInfo(ATTACKINFO_BLOODRIVERN_JUMPATTACK);\n \n        local len = obj.sq_GetIntData(SKILL_BLOODRIVERN, 3);\n        //獲得前進距離 len = 300\n//        len = ( len * obj.getVar(\"size\").get_vector(0) ) / 100 ;\n        //根據大小提升前進距離\n        local ani = obj.sq_GetCurrentAni();\n        local delay = ani.getDelaySum(false);\n \n        obj.getVar(\"len\").clear_vector();\n        obj.getVar(\"len\").push_vector(len);//0\n        obj.getVar(\"len\").push_vector(delay);//1\n        obj.getVar(\"len\").push_vector(obj.getXPos() );//2\n \n        local attT = obj.sq_GetIntData(SKILL_BLOODRIVERN, 4);\n        //攻擊間隔 150毫秒\n        obj.setTimeEvent(0,attT,0,false);       \n \n        local attackBonusRate = obj.sq_GetBonusRateWithPassive(SKILL_BLOODRIVERN, STATE_BLOODRIVERN, 1, 1.0);\n        obj.sq_SetCurrentAttackBonusRate(attackBonusRate);              \n        obj.sq_SetStaticSpeedInfo(SPEED_TYPE_ATTACK_SPEED, SPEED_TYPE_ATTACK_SPEED,\n            SPEED_VALUE_DEFAULT, SPEED_VALUE_DEFAULT, 1.0, 1.0);\n    }else if (state == 4)\n    {\n        //砸地 &amp;&amp; 蹲下\n        sq_SetMyShake(obj,8,500);\n        sq_flashScreen(obj,100,2000,1000,150, sq_RGB(0,0,0), GRAPHICEFFECT_NONE, ENUM_DRAWLAYER_BOTTOM);\n        //震動和閃屏\n        local attackBonusRate = obj.sq_GetBonusRateWithPassive(SKILL_BLOODRIVERN, STATE_BLOODRIVERN, 2, 1.0 + (obj.getVar(\"size\").get_vector(0) /100.0).tofloat() );\n        //攻擊隨著大小的提升而提升\n        obj.sq_StartWrite();\n        obj.sq_WriteDword(attackBonusRate); // attackBonusRate\n        obj.sq_WriteDword(61);  // attackBonusRate\n        obj.sq_WriteDword(obj.getVar(\"size\").get_vector(0) );   // attackBonusRate\n        obj.sq_SendCreatePassiveObjectPacket(24357, 0, obj.sq_GetIntData(SKILL_BLOODRIVERN, 5), 1, 0);\n \n        obj.getVar(\"size\").clear_vector();\n        obj.getVar(\"size\").push_vector(100);\n        //初始化大小100\n        obj.sq_SetCurrentAnimation(CUSTOM_ANI_BLOODRIVERN_FINISH);\n    }\n    obj.sq_SetStaticSpeedInfo(SPEED_TYPE_ATTACK_SPEED, SPEED_TYPE_ATTACK_SPEED,\n        SPEED_VALUE_DEFAULT, SPEED_VALUE_DEFAULT, 1.0, 1.0);\n    if (state &lt; 4)\n    {\n        //如果是砸地 &amp;&amp; 蹲下狀態下不改變大小\n        local currentAni = sq_GetCurrentAnimation(obj);\n        local sizeRate = size.tofloat()/100.0;\n        currentAni.setImageRateFromOriginal(sizeRate, sizeRate);\n        currentAni.setAutoLayerWorkAnimationAddSizeRate(sizeRate);\n        sq_SetAttackBoundingBoxSizeRate(currentAni, sizeRate, sizeRate, sizeRate);\n    }\n}\n \n \nfunction onTimeEvent_BLOODRIVERN(obj, timeEventIndex, timeEventCount)\n{\n    local state = obj.getVar(\"state\").get_vector(0);\n    if (state == 1 || state == 3)\n    {\n        if (timeEventIndex == 0)\n        {\n            obj.resetHitObjectList();\n        }\n    }\n}\nfunction onProc_BLOODRIVERN(obj)\n{\n \n    local state = obj.getVar(\"state\").get_vector(0);\n    local pAni = obj.sq_GetCurrentAni();\n    local currentT = sq_GetCurrentTime(pAni);\n \n    if (state == 1 || state == 2)\n    {\n \n    }else if (state == 3)\n    {//跳躍，根據len進行位移\n \n \n        local posX = obj.getVar(\"len\").get_vector(2);\n        local delayT = obj.getVar(\"len\").get_vector(1);\n        local len = obj.getVar(\"len\").get_vector(0);\n \n \n        local v = sq_GetAccel(0, len, currentT, delayT, true);\n        local srcX = posX;\n         \n        local dstX = sq_GetDistancePos(srcX, obj.getDirection(), v);\n          \n        if(obj.isMovablePos(dstX, obj.getYPos() ))\n        {\n            sq_setCurrentAxisPos(obj, 0, dstX);\n        }\n        //進行位移\n    }\n}\n \nfunction onEndCurrentAni_BLOODRIVERN(obj)\n{\n    local state = obj.getVar(\"state\").get_vector(0);\n    if (state == 0)\n    {\n        obj.getVar(\"state\").clear_vector();\n        obj.getVar(\"state\").push_vector(1);\n        obj.sq_AddSetStatePacket(STATE_BLOODRIVERN, STATE_PRIORITY_USER, true);\n    }else if (state == 1)\n    {\n        local maxSize = obj.getVar(\"mSize\").get_vector(0);\n        if( !obj.isDownSkillLastKey() || obj.getVar(\"size\").get_vector(0) &gt; maxSize)\n        {//如果我沒有按下技能鍵或者我的大小已經超過了最大值了就化身大狗，反之提升大小\n          \n            obj.getVar(\"state\").clear_vector();\n            obj.getVar(\"state\").push_vector(2);\n            obj.sq_AddSetStatePacket(STATE_BLOODRIVERN, STATE_PRIORITY_USER, true);\n        }else{\n            local currSize = obj.getVar(\"size\").get_vector(0);\n            obj.getVar(\"size\").set_vector(0,currSize + obj.sq_GetIntData(SKILL_BLOODRIVERN, 1) );\n \n            obj.getVar(\"state\").clear_vector();\n            obj.getVar(\"state\").push_vector(1);\n            obj.sq_AddSetStatePacket(STATE_BLOODRIVERN, STATE_PRIORITY_USER, true);\n        }\n    }else if (state == 2)\n    {\n        obj.getVar(\"state\").clear_vector();\n        obj.getVar(\"state\").push_vector(3);\n        obj.sq_AddSetStatePacket(STATE_BLOODRIVERN, STATE_PRIORITY_USER, true);\n    }else if (state == 3)\n    {\n        obj.getVar(\"state\").clear_vector();\n        obj.getVar(\"state\").push_vector(4);\n        obj.sq_AddSetStatePacket(STATE_BLOODRIVERN, STATE_PRIORITY_USER, true);\n    }else if (state == 4)\n    {\n \n        obj.sq_AddSetStatePacket(STATE_STAND, STATE_PRIORITY_USER, false);\n    }\n        obj.sq_SetCurrentAnimation(CUSTOM_ANI_EMPERORCOMBINATIONBODY_01);\n        obj.sq_SetCurrentAttackInfo(ATTACKINFO_EMPERORCOMBINATIONATTACK1);\n        obj.sq_SetCurrentAnimation(CUSTOM_ANI_EMPERORCOMBINATIONBODY_02);\n        obj.sq_SetCurrentAttackInfo(ATTACKINFO_EMPERORCOMBINATIONATTACK2);\n        obj.sq_SetCurrentAnimation(CUSTOM_ANI_EMPERORCOMBINATIONBODY_03);\n        obj.sq_SetCurrentAttackInfo(ATTACKINFO_EMPERORCOMBINATIONATTACK3);\n        obj.sq_SetCurrentAttackInfo(ATTACKINFO_EMPERORCOMBINATIONSTUNATTACK);\n}</code></pre>\n\n<p>&nbsp;</p>",
    "auth_users": "学院搬运工",
    "img": "https://dafstatic.oss-cn-beijing.aliyuncs.com/static/title/level4.gif",
    "create_at": "2023-07-03T12:38:25.424",
    "view_num": 623
}